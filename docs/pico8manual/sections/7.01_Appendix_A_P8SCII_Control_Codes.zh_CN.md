# 7.01 附录 A: P8SCII 控制码

------------

使用 [**PRINT**](https://www.lexaloffle.com/dl/docs/pico-8_manual.html#PRINT)() 打印时，某些字符具有特殊含义，可以用来改变光标位置和文本渲染样式。PICO-8 中的控制字符是 CHR(0)..CHR(15)，可以写成转义序列（例如 "\\n" 表示换行等）。

下面的一些控制码需要参数，这些参数使用一种超集于十六进制格式的方案书写。也就是说，'0'..'f' 也表示 0..15。但是 'f' 之后的字符也被接受：'g' 表示 16 等等。这样的参数在下面表示为 P0, P1。

例如，要以蓝色背景 ("\\#c") 和深灰色前景 ("\\f5") 打印：

PRINT("\\#C\\F5 蓝色 ")  

PRINT() 对绘图状态的唯一影响是改变光标位置和前景色；所有其他属性在每次调用 [**PRINT**](https://www.lexaloffle.com/dl/docs/pico-8_manual.html#PRINT)() 时都会重置。

#### ■ 控制码

0 "\\0"   终止打印  
1 "\\\*"   重复下一个字符 P0 次。例如："\\\*3a" --> aaa  
2 "\\#"   用颜色 P0 绘制实心背景  
3 "\\-"   水平移动光标 P0-16 像素  
4 "\\|"   垂直移动光标 P0-16 像素  
5 "\\+"   移动光标 P0-16, P1-16 像素  
6 "\\^"   特殊命令（见下文）  
7 "\\a"   音频（见下文）  
8 "\\b"   退格  
9 "\\t"   制表符  
a "\\n"   换行  
b "\\v"   装饰前一个字符（见下文）  
c "\\f"   设置前景色  
d "\\r"   回车  
e "\\014" 切换到 0x5600 处定义的字体  
f "\\015" 切换到默认字体  

#### ■ 特殊命令

这些命令都以 "\\^" 开头，并且最多接受两个参数（P0, P1）。例如，要将屏幕清除为深蓝色：PRINT("\\^c1")

1..9 跳过 1,2,4,8,16,32..256 帧  
c 清屏为颜色 P0，将光标设置为 0,0  
d 设置每打印一个字符的延迟为 P0 帧  
g 将光标位置设置为起始位置  
h 将起始位置设置为当前光标位置  
j 跳转到绝对位置 P0\*4, P1\*4（以屏幕像素为单位）  
r 设置右侧字符换行边界为 P0\*4  
s 设置制表符宽度为 P0 像素（用于 "\\t"）  
x 设置字符宽度（默认：4）  
y 设置字符高度（默认：6）  

#### ■ 渲染模式选项

// 在这些前面加上 "-" 以禁用：例如 ?"\\^i on \\^-i off "

w 宽模式：按 2x1 缩放  
t 高模式：按 1x2 缩放  
\= 条纹模式：当使用宽模式或高模式时，只绘制偶数像素  
p 弹球模式：相当于同时设置宽模式、高模式和条纹模式  
i 反转  
b 边框：在左侧和顶部添加 1 像素的填充（默认开启）  
\# 实心背景  // 默认关闭，但当使用 "\\#" 时会自动开启  

#### ■ 原始内存写入

下面两个命令接受 4 个字符的十六进制参数：

@addrnnnn\[binstr\] 将 nnnn 字节写入地址 addr  
!addr\[binstr\]     将所有剩余字符写入地址 addr  

例如，要将 4 字节写入屏幕内存的中间位置：

\>?"\\^@70000004xxxxhello"  

#### ■ 单次字符

可以使用 \\^. 后跟 8 字节的原始二进制数据，或 \\^: 后跟 8 个 2 位十六进制值来指定和打印内联字符数据。数据格式与自定义字体相同；每个字节指定一行 1 位像素值，最低位在左侧。

\\^.\[8 字节原始二进制数据\]  
\\^:\[16 字节十六进制\]  

例如，打印一个猫：

\> ?"\\^:447cb67c3e7f0106"  

#### ■ 音频

? ?"\\A" -- 单音蜂鸣 ?"\\A12" -- 播放现有数据在 SFX 12

如果没有指定 SFX 索引，则会自动选择一个未使用的 SFX 在 60..63 之间。为了在播放前填充 SFX 数据，可以附加以下命令。

1\. （可选）SFX 属性必须在开始时出现一次，因为它们适用于整个声音：

s P0     设置 SFX 速度  
l P0 P1  设置 SFX 循环开始和结束点  

2\. 音符数据：

音符写成 a..g，可选后跟升号 # 或降号 - 和八度号。

PRINT "\\ACE-G" -- 小三和弦  

空音符可以写成点：

PRINT "\\AC..E-..G" -- 断奏小三和弦  

音符属性命令适用于随后的音符：

i P0    设置乐器（默认：5）  
v P0    设置音量     （默认：5）  
x P0    设置效果     （默认：0）  
< > 增加或减少音量 1

例如，要以快速（速度 4）、断奏（效果 5）的琶音从 C1 开始播放：

PRINT "\\AS4X5C1EGC2EGC3EGC4"  

#### ■ 装饰字符

控制字符 \\v 可以用来在不管理光标位置的情况下，使用给定偏移量装饰最后打印的字符。打印装饰字符后，会恢复之前的光标位置。

格式为 \\v P0 char，其中 P0 是一个数字，给出所需的偏移量，char 是要打印的字符（相对于之前打印的字符）。

偏移量将 x 打包到最低 2 位，并从阅读顺序的 (-2,-8) 开始。因此 3 表示 (+1, -8)，4 表示 (-2, -7) 等等。

例如，要写 "cafÃ©!"，使用逗号来绘制尖音符号：

PRINT"\\NCAFE\\VB,!"  

在这种情况下 P0 是 'b'，读作数字 11。因此逗号绘制在：

x = (11%4)-2 = 1  
y = (11\\4)-8 = -6  

#### ■ 自定义字体

自定义字体可以在 0x5600 处定义，由每个字符 8 字节 \* 256 字符 = 2048 字节组成。每个字符是一个 8x8 位图（1 位/像素），从顶部开始，每一行是一个字节，从 0x1 开始在左侧。

前 128 字节（字符 0~15 从不绘制）描述字体的属性：

0x5600 字符宽度（像素）（可以大于 8，但只绘制 8 像素）  
0x5601 字符宽度（字符 128 及以上）  
0x5602 字符高度（像素）  
0x5603 绘制偏移 x  
0x5604 绘制偏移 y  
0x5605 标志：0x1 应用_size_adjustments  0x2: 相对于光标起始位置应用制表符  
0x5606 制表符宽度（像素）（仅在使用替代字体时使用）  
0x5607 未使用  

接下来的 120 字节用于调整字符 16..255 的宽度和垂直偏移。每个半字节（低位半字节优先）描述一个字符的调整：

位 0x7: 调整字符宽度为 0,1,2,3,-4,-3,-2,-1  
位  0x8: 当设置时，将字符向上绘制一个像素（适用于拉丁字符的重音符号）  

#### ■ 默认属性

虽然属性在每次调用 [**PRINT**](https://www.lexaloffle.com/dl/docs/pico-8_manual.html#PRINT)() 时都会重置，但可以通过写入内存地址 0x5f58..0x5f5b 来设置它们的默认值。

0x5f58 // 位域  
  0x1  当设置为 0x1 时，位 1..7 被观察：  
  0x2  填充  
  0x4  宽  
  0x8  高  
  0x10 实心背景  
  0x20 反转  
  0x40 条纹（当宽或高时）  
  0x80 使用自定义字体

    // 例如：poke(0x5f58, 0x1 | 0x2 | 0x4 | 0x8 | 0x20 | 0x40)  -- 处处弹球

0x5f59 char\_w   (低半字节), char\_h   (高)  
0x5f5a char\_w2  (低半字节), tab\_w    (高)  
0x5f5b offset\_x (低半字节), offset\_y (高)

  // 任何半字节等于 0 都被忽略  
// tab\_w（全局制表符宽度）值映射到 4..60